<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Login</title>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script></head>
<body>


<script async src="https://telegram.org/js/telegram-widget.js?14" data-telegram-login="{{BOTNAME}}" data-size="large" data-onauth="onTelegramAuth(user)" data-request-access="write"></script>
<script type="text/javascript">
  // function onTelegramAuth(user) {
  //   alert('Logged in as ' + user.first_name + ' ' + user.last_name + ' (' + user.id + (user.username ? ', @' + user.username : '') + ')');
  //
  //   $.ajax({
  //   url: ‘/login’,
  //   method: ‘post’,
  //   data: user,
  //   dataType:’json’,
  //   success: function (data) {
  //   location.reload()
  //   },
  //
  // }

  function onTelegramAuth(user) {
      alert("start");
      {#test();#}
      document.body.append(user);
$.ajax({
url:'/get_token',
method: 'post',
data: user,
dataType:'json',
success: function (data) {
    alert(data['token']);
location.reload();
},
error: function (error) {
alert(error);
}
});
      {#alert("finish");#}
}

function test(){
   $.ajax({
	url: '/login',
	method: 'get',
	dataType: 'json',
	success: function(data){
		alert(data.text);    /* выведет "Текст" */
		alert(data.error);   /* выведет "Ошибка" */
	}
});
}

</script>

</body>
</html>